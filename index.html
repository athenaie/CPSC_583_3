<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1> Marissa Baden Assignment 3: Obesity and Favourite Cereals</h1>

<!-- load the d3.js library -->
<script src="https://d3js.org/d3.v3.min.js"></script>

<script>

// set width and height
var width = 800;
var height = 500;

// D3 Projection
var projection = d3.geo.albersUsa()
           // translate to center of screen
				   .translate([width/2, height/2])
           // scale down to see entire US
				   .scale([1000]);

           // Define path generator that will convert GeoJSON to SVG paths
           var path = d3.geo.path()
                   // tell path generator to use albersUsa projection
           		  	 .projection(projection);
// Define colour output
var colour = d3.scale.linear()
   			  .range(["hsl(0, 100%, 80%)","hsl(0, 100%, 70%)","hsl(0, 100%, 60%)","hsl(0, 100%, 50%)","hsl(0, 100%, 40%)","hsl(0, 100%, 30%)","hsl(0, 100%, 20%)","hsl(0, 100%, 10%)"]);

// set the ranges for the legend
var legendText = ["68 - 69.9%", "66 - 67.9%", "64 - 65.9%", "62 - 63.9%", "60 - 61.9%", "58 - 59.9%", "56 - 57.9%", "54 - 55.9%"]

//Create SVG element and append map to the SVG
var svg = d3.select("body")
			.append("svg")
			.attr("width", width)
			.attr("height", height);

// append tooltip div
var div = d3.select("body")
		    .append("div")
    		.attr("class", "tooltip")
    		.style("opacity", 0);

// load in obesity data
d3.csv("data/obesity.csv", function(data) {
colour.domain([0,1,2,3,4,5,6,7]);

// Load GeoJSON data and merge with states data
d3.json("data/us-states.json", function(json) {

// Loop through each state data value in the .csv file
for (var i = 0; i < data.length; i++) {

  // Get the state Name
  var dataState = data[i].state;

  // Get the data value
  var dataValue = data[i].value;

  // Find the corresponding state in GeoJSON
  for (var j = 0; j < json.features.length; j++)  {
  	var jsonState = json.features[j].properties.name;

  	if (dataState == jsonState) {

  	// Copy overweight value into the JSON
  	json.features[j].properties.overweight = dataValue;

  	// Stop looking through the JSON
  	break;
  	}
  }
}

// Bind data to SVG
// create path for each GeoJSON feature
svg.selectAll("path")
  .data(json.features)
  .enter()
  .append("path")
  .attr("d", path)
  .style("stroke", "#fff")
	.style("stroke-width", "2")
  .style("fill", function(d){
    var value = d.properties.overweight;
    return colour(value);
  // tooltip code goes here
});

// legend
var legend = d3.select("body").append("svg")
  .attr("class", "legend")
  .attr("width", 200)
  .attr("height", 500)
    .selectAll("g")
    .data(colour.domain().slice().reverse())
    .enter()
    .append("g")
  .attr("transform", function(d, i) {return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
    .attr("width", 20)
    .attr("height", 20)
    .style("fill", colour);

  legend.append("text")
    .data(legendText)
    .attr("x", 25)
    .attr("y", 10)
    .attr("dy", ".5em")
    .text(function(d) {return d;});
  });
});

</script>

</body>
</html>
